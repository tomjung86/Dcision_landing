<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dcision â€” Confirmation</title>
  <link rel="stylesheet" href="styles/style.css" />
  <link rel="stylesheet" href="styles/modal.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="page-wrapper">
    <header>
      <img src="img/DcisionLogo.svg" alt="Dcision Logo" class="header-logo" />
      <nav class="nav-buttons">
        <a href="/">Home</a>
      </nav>
    </header>

    <!-- About Modal, same as your page if you want it available -->
    <div class="modal" id="aboutModal">
      <div class="modal-content">
        <span class="close-btn" data-modal-close>&times;</span>
        <div class="fs-inner">
          <img src="img/DcisionLogo.svg" alt="Dcision Logo" class="profile-image" />
          <h2>About Dcision</h2>
          <h3 class="subtitle">One trusted verdict, no scrolling, no second guessing</h3>
          <section>
            <h3>What It Is</h3>
            <p>Dcision is a new kind of decision engine that helps people choose with confidence. It gives one trusted recommendation, backed by facts and aligned with values.</p>
          </section>
          <section>
            <h3>How It Works</h3>
            <p>TrustGraph gathers verified sources, applies preferences, and flags vague claims. The result is one clear answer that is explainable.</p>
          </section>
          <section>
            <h3>Status</h3>
            <p>Dcision is in development.</p>
          </section>
        </div>
      </div>
    </div>

    <main>
      <div class="main-content" style="text-align:center; max-width:720px; margin:0 auto;">
        <img src="img/DcisionLogo.svg" alt="Dcision logo large" class="main-logo" style="width:120px; height:auto; margin-bottom:16px;">
        <h1>Thank you for subscribing</h1>
        <p><strong>Your email is confirmed.</strong></p>
        <p>We only use your details to keep you updated on Dcision. Your data is confidential and never sold.</p>

        <div id="confirm-status" class="p" style="margin-top:16px;"></div>

        <a href="/" class="btn" style="margin-top:24px; display:inline-block;">Back to home</a>
      </div>
    </main>

    <!-- Contact Modal -->
    <div class="modal" id="contactModal">
      <div class="modal-content">
        <span class="close-btn" data-modal-close>&times;</span>
        <h2>Contact</h2>
        <form id="contactForm">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" required />

          <label for="email">Email</label>
          <input type="email" id="email" name="email" required />

          <label for="message">Message</label>
          <textarea id="message" name="message" rows="5" required>
Hi, I would like to request a Dcision demo...
          </textarea>
          <input type="text" name="website" id="website" autocomplete="off" style="display:none;" />
          <button type="submit">Send Message</button>
        </form>
      </div>
    </div>

    <footer>
      <div class="footer-content">
        <p>&copy; 2025 Tom Schorel. Dcision and TrustGraph are trademarks. All rights reserved.</p>
      </div>
    </footer>
  </div>

  <script src="scripts/modal.js"></script>
  <script src="scripts/contact.js"></script>

  <!-- Optional: confirm the token with Supabase RPC. Remove if not needed. -->
  <script>
    (async function () {
      const el = document.getElementById("confirm-status");
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");
      if (!token) return; // static thank you is enough

      try {
        // If you already load supabase-js elsewhere, use that. 
        // Here we call the RPC directly through REST.
        const SUPABASE_URL = "https://YOUR-PROJECT-REF.supabase.co";
        const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";

        const res = await fetch(`${SUPABASE_URL}/rest/v1/rpc/confirm_waitlist`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "apikey": SUPABASE_ANON_KEY,
            "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
          },
          body: JSON.stringify({ token })
        });

        if (!res.ok) {
          el.textContent = "We could not verify the confirmation link. It may have been used already.";
          el.style.color = "#b00020";
          return;
        }

        el.textContent = "Your confirmation is recorded. Welcome to the waitlist.";
        el.style.color = "var(--ink-muted)";
      } catch (e) {
        // Silent failure keeps the page as a simple thank you
      }
    })();
  </script>
</body>
</html>
